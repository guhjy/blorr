#' @importFrom magrittr %>% %<>% use_series extract2 extract
#' @importFrom dplyr mutate if_else pull slice
#' @importFrom tibble tibble as_tibble
#' @importFrom rlang sym eval_tidy !!
#' @importFrom glue glue
#' @importFrom stats coef confint
response_var <- function(model) {

  model %>%
    use_series(terms) %>%
    extract2(2)

}

# name of the data set
data_name <- function(model) {

  model %>%
    use_series(call) %>%
    extract2(4)

}

# number of observations
data_nrows <- function(model) {

  model %>%
    use_series(data) %>%
    nrow

}

# model convergence status
converge_status <- function(model) {

  model %>%
    use_series(converged)

}

# residual degrees of freedom
residual_df <- function(model) {

  model %>%
    use_series(df.residual)

}

# model degrees of freedom
model_df <- function(model) {

  model %>%
    use_series(df.null)

}

# log likelihood
model_loglik <- function(model) {

  model %>%
    use_series(deviance)

}

# null likelihood
null_ll <- function(model) {

  dep <- response_var(model)

  dat <- model %>%
    use_series(call) %>%
    use_series(data) %>%
    eval_tidy()

  glm(glue(dep, ' ~ 1'), data = dat,
      family = binomial(link = 'logit')) %>%
    logLik %>%
    extract2(1)

}

# response profile
resp_profile <- function(model) {

  resp <- model %>%
    response_var

  model %>%
    use_series(data) %>%
    pull(!!resp) %>%
    as.factor %>%
    table

}


# analysis of maximum likelihood estimates
predictor_names <- function(model) {

  model %>%
    use_series(coefficients) %>%
    names

}

# model df
predictor_df <- function(model) {

  model %>%
    use_series(rank) %>%
    rep_len(x = 1)

}

# model estimate
predictor_est <- function(model) {

  model %>%
    use_series(coefficients) %>%
    unname

}

# extract columns from model summary
predictor_mine <- function(model, col_name = NULL) {

  model %>%
    summary %>%
    use_series(coefficients) %>%
    extract(, col_name) %>%
    unname

}

# standard error
predictor_se <- function(model) {
  predictor_mine(model, 'Std. Error')
}

# z value
predictor_zval <- function(model) {
  predictor_mine(model, 'z value')
}

# p values
predictor_pval <- function(model) {
  predictor_mine(model, 'Pr(>|z|)')
}

# odds ratio estimate
# odds ratio effects
odds_effect <- function(model) {

  model %>%
    coef %>%
    names %>%
    extract(-1)

}

# odds ratio point estimates
odds_point <- function(model) {

  model %>%
    coef %>%
    exp %>%
    extract(-1) %>%
    unname

}

# odds ratio confidence intervals
odds_conf_limit <- function(model) {

  model %>%
    confint %>%
    as_tibble %>%
    slice(2:n()) %>%
    exp

}



